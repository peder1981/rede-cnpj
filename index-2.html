<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Unknown </title></head><body>
<h1 id="rede-cnpj-visualizacao-de-dados-publicos-de-cnpj">REDE-CNPJ - Visualização de dados públicos de CNPJ</h1>
<p>Ferramenta para observar o relacionamento entre empresas e sócios, a partir dos dados públicos disponibilizados pela Receita Federal.<br></p>
<h3 id="video-no-youtube">Vídeo no youtube<br></h3>
<p><a href="https://youtu.be/nxz9Drhqn_I"><img alt="youtube" src="http://img.youtube.com/vi/nxz9Drhqn_I/0.jpg" /></a></p>
<p><br>Outros vídeos de utilização:<br>
Opções básicas dos botões: https://youtu.be/-Ug6ToTRnE4 <br>
Criar uma ligação no gráfico: https://youtu.be/8I0oNb4U9Rw <br>
Aumentar tamanho da ligação: https://youtu.be/7hy74LE8e7A <br>
Exportar dados como json: https://youtu.be/WKn02G9yHbQ <br>
Arrastar células do Excel: https://youtu.be/Oxze-d4V7kE <br>
A rotina possibilita visualizar de forma gráfica os relacionamentos entre empresas e sócios, a partir da base de dados públicos de cnpj da Receita Federal. <br>
Foi testada nos navegadores Firefox, Edge e Chrome. NÃO FUNCIONA no Internet Explorer. <br></p>
<h2 id="versao-online-com-base-completa-de-dados-publicos-de-cnpj">Versão online com base completa de dados públicos de CNPJ:</h2>
<p>https://www.redecnpj.com.br<br>
Leia as informações iniciais. Para fazer uma consulta, digite um CNPJ, o radical de CNPJ, a Razão Social Completa, o Nome Completo de Sócio ou CPF do Sócio (dá resultado impreciso). Para exibir um CNPJ aleatório, digite "TESTE". Pode-se inserir vários CNPJs de uma só vez, separando-os por (;). Para fazer busca por parte da Razão Social ou parte do nome de Sócio, utilize o asterisco (*) na parte que faltar do nome.
Funciona parcialmente em celular, com menu errático.</p>
<h2 id="versao-em-python">Versão em python:</h2>
<p>É preciso ter instalado no computador:
- python <b>versão 3.9</b> ou posterior.<br> 
- 40GB de espaço livre, para utilizar a base de CNPJs em sqlite.</p>
<p>Use o comando<br>
pip install -r requirements.txt<br>
para instalar as bibliotecas utilizadas no projeto.<br><br>
Para iniciar o script, em um console digite<br>
python rede.py<br>
A rotina abrirá o endereço http://127.0.0.1:5000/rede/ no navegador padrão.
As opções por linha de comando são exibidas fazendo python rede.py -h<br>
A pasta contém um arquivo <b>cnpj_teste.db</b>, que é o banco de dados com poucos itens para testar o funcionamento da rotina.<br> 
Orientações detalhadas para instalação em Windows no link https://github.com/rictom/rede-cnpj/blob/master/doc/instalacao_windows.md<br></p>
<h2 id="como-utilizar-o-banco-de-dados-publicos-completo-de-cnpjs">Como utilizar o Banco de dados públicos completo de CNPJs:</h2>
<p>O projeto https://github.com/rictom/cnpj-sqlite contém o código para a conversão dos arquivos zipados do site da Receita para o formato SQLITE, gerando o arquivo <b>cnpj.db</b> com a base completa. 
O link para a base completa em sqlite já tratada está disponível em https://github.com/rictom/cnpj-sqlite#arquivo_sqlite.<br>
O código foi ajustado para o formato disponibilizado pela Receita Federal em 2021 e 2022.<br> 
Para utilizar a base completa <b>cnpj.db</b> na <b>REDE-CNPJ</b>, altere o arquivo de configuração rede.ini, mudando a linha de configuração para<br>
<b>base_receita = cnpj.db</b><br></p>
<h2 id="opcoes">Opções:</h2>
<p>A roda do mouse expande ou diminui o tamanho da exibição.<br>
Fazendo click duplo em um ícone, a rotina expande as ligações. Por exemplo, clique duplo no ícone de uma pessoa, exibirá todas as empresas que esta é sócia. Clique duplo em um ícone de CNPJ, exibirá todos os sócios da empresa.<br>
Apertando SHIFT, é possível selecionar mais de um ícone. <br>
Pressionando CTRL e arrastando na tela, adiciona a seleção os itens da área.
Clicar no botão do meio do mouse (roda) faz aparecer janela para editar uma Nota, que aparece numa terceira linha abaixo do ícone.</p>
<p>Outras opções da rede estão no menu contextual do mouse (botão direito), sendo configuradas teclas de atalho correspondentes aos comandos:</p>
<h2 id="tecla-descricao-do-comando">Tecla – Descrição do comando.</h2>
<ul>
<li>TECLAS de 1 a 9 - Inserir camadas correspondente ao número sobre o nó selecionado;</li>
<li>I - Inserir CNPJ, Razão Social completa ou nome completo de sócio. Poderão ser colocados vários CNPJs ao mesmo tempo, separados por ponto e vírgula (;).</li>
<li>U - Criar item novo (que não seja PF ou PJ) e ligar aos itens selecionados;</li>
<li>E - Editar dados do item (que não seja PF ou PJ) selecionado;</li>
<li>
<p>CRTL+Z – Desfaz Inserção;</p>
</li>
<li>
<p><b>SubMenu Ligar:</b></p>
</li>
<li>U - Ligar para novo item;</li>
<li>L - Ligar itens selecionados, ligação tipo estrela (o primeiro ligado aos demais);</li>
<li>SHIFT+L - Remover ligação entre itens selecionados;</li>
<li>Remover Ligacoes - Remove todas as ligações dos itens selecionados;</li>
<li>
<p>K - Ligar itens selecionados, ligação tipo fila (o primeiro ligado ao segundo, o segundo ao terceiro, etc);</p>
</li>
<li>
<p><b>SubMenu Visualização:</b></p>
</li>
<li>A - Gráfico em Nova Aba - Abre aba com os itens selecionados;</li>
<li>Q - Quebrar o gráfico em abas - Divide o gráfico em partes menores, mantendo as ligações</li>
<li>Abre OpenStreetMap - Abre Mapa com os endereços de empresas;</li>
<li>P - Fixar o nó na posição;</li>
<li>SHIFT+P - Desfixar todos os nós do gráfico;</li>
<li>CTRL+P - Fixa um nó em cada grupo conexo (para evitar que o gráfico se expanda indefinidamente);</li>
<li>SubMenu Visualização&gt;Rótulos:</li>
<li>E - Editar rótulo; </li>
<li>N - Rótulo - Exibe apenas o primeiro nome;</li>
<li>
<p>SHIFT+N - Oculta/exibe texto da ligação;</p>
</li>
<li>
<p>Alterar Ícone;</p>
</li>
<li>C - Colorir os nós selecionados;</li>
<li>Escolher Cor;</li>
<li>D – Abre um popup com dados;</li>
<li>SHIFT+D – Abre numa nova aba com Dados;</li>
<li>CTRL+D – Lista ids dos itens selecionados;</li>
<li>Altera o nome da aba;</li>
<li>Escala Inicial - Coloca a exibição sem zoom, na escala inicial.</li>
<li>
<p>Barra de Espaço - Parar/reiniciar leiaute (se a tela tiver muitos nós, os comandos funcionam melhor se o leiaute estiver parado);</p>
</li>
<li>
<p>F - Localizar - Localizar na Tela Nome, CNPJ ou CPF;</p>
</li>
<li>SHIFT+F - Localizar apenas na seleção;</li>
<li>CTRL+F - Localiza por campo (como cor do item);</li>
<li>J – Seleciona itens adjacentes;</li>
<li>SHIFT+J – Seleciona árvores dos itens selecionados;</li>
<li>CTRL+J - Itens com mais ligações - Opção para selecionar os itens do gráfico com mais ligações;</li>
<li>Itens ligados a coloridos;</li>
<li>Grupos com duas cores;</li>
<li>CTRL+A - Seleciona todos os itens;</li>
<li>CTRL+SHIFT+A - Inverte seleção;</li>
<li>SubMenu - Busca em sites:</li>
<li>G – Abre o nó numa aba do site Google;</li>
<li>SHIFT+G – Abre o endereço no Google Maps (só CNPJs);</li>
<li>H ou CTRL+G - Raspa a página do Google e coloca links;</li>
<li>SHIFT+H - Raspa a página do Google e busca palavras chave nos links;</li>
<li>Jusbrasil - Busca no site Jusbrasil</li>
<li>
<p>Portal da Transparência - Busca no Portal da Transparência;</p>
</li>
<li>
<p><b>SubMenu Salvar/Abrir:</b></p>
</li>
<li>
<p>Salvar dados em Excel;</p>
</li>
<li>Salvar em formato i2 Chart Reader;</li>
<li>Salvar imagem em formato SVG;</li>
<li>Salvar Arquivo Json - salva dados do gráfico no formato json;</li>
<li>Abrir Arquivo Json;</li>
<li>Exportar/Importar JSON ao Servidor - Exportar ou importar dados do gráfico em formato JSON carregados no servidor;</li>
<li>
<p>Banco de Dados - Exporta dados para banco de dados sqlite (só para usuário local);</p>
</li>
<li>
<p><b>SubMenu Excluir</b></p>
</li>
<li>
<p>DEL – Excluir itens selecionados.</p>
</li>
<li>SHIFT+DEL – Excluir todos os itens.</li>
<li>Excluir Nó mantendo Link;</li>
<li>Simplifica Gráfico - Remove itens nas bordas do gráfico que não tenham destaque;</li>
<li>Excluir itens isolados - Remove itens sem ligação.</li>
</ul>
<p>Os comandos valem para o último nó selecionado ou nós selecionados, que ficam em destaque com a animação no contorno ods ícones.
Pressionando SHIFT e click, é possível selecionar mais de um ícone para fazer Exclusão ou para Expansão de vínculos.
Pode-se arrastar células com listas de CNPJs do Excel para a janela, ou arrastar arquivos csv ou json.</p>
<h2 id="fonte-dos-dados">Fonte dos dados:</h2>
<p>Base de CNPJ está disponível em https://www.gov.br/receitafederal/pt-br/assuntos/orientacao-tributaria/cadastros/consultas/dados-publicos-cnpj ou http://200.152.38.155/CNPJ/ em formato csv.<br>
Arquivo CNPJ.db sqlite já tratado pelo projeto https://github.com/rictom/cnpj-sqlite está disponível em 
https://github.com/rictom/cnpj-sqlite#arquivo_sqlite. Eu tento atualizar esse arquivo mensalmente.<br>
Baixe o arquivo CNPJ.7z e descompacte usando o 7zip (https://www.7-zip.org/download.html). O arquivo descompactado tem cerca de 25GB.<br></p>
<h2 id="outras-referencias">Outras referências:</h2>
<p>Biblioteca em javascript para visualização:<br>
https://github.com/anvaka/VivaGraphJS<br></p>
<p>Menu Contextual:<br>
https://www.cssscript.com/beautiful-multi-level-context-menu-with-pure-javascript-and-css3/</p>
<p>Ícones:<br>
https://www.flaticon.com<br>
https://fontawesome.com<br></p>
<h2 id="historico-de-versoes">Histórico de versões</h2>
<p><b>versão 0.8.8 (setembro/2022)</b>
- busca por Nome Fantasia de cnpj;<br>
- alteração no espaçamento dos botões para Android;<br>
- popup de mensagem inicial vai aparecer menos;<br>
- melhoria no visual do popup nos mapas;<br>
- remoção de caixa de entrada para perguntar a camada do item a ser inserido. Aperte uma tecla de 2 a 9 para inserir mais camadas;<br>
- clicar no botão camada, duplo-clique ou pressionar tecla 1 de forma repetida irá trazer mais camadas.<br></p>
<p><b>versão 0.8.7 (setembro/2022)</b>
- abre endereços com OpenStreetMap, pelo botão <img alt="image" src="https://user-images.githubusercontent.com/71139693/189489292-d00f9e2f-f9e7-497d-a97a-c6fde790ad1d.png" /> no canto superior direito da tela: <br>
 <img alt="mapa" src="https://user-images.githubusercontent.com/71139693/189489167-bdb49057-aa1a-422b-866f-3b93c7cc94ff.png" />
<br>
- o parâmetro geocode_max em rede.ini define a quantidade de endereços que serão buscados pela api do OpenStreetMap. Para evitar bloqueio, é feito uma pausa de um segundo entre cada chamada da api. Se a quantidade de endereços for maior que o parâmetro geocode_max, os endereços dos cnpjs serão substituidos pelas coordenadas dos municipios de acordo com tabela do IBGE.<br>
- em cada popup de endereço, há quatro opções: a)abrir o endereço no Google Maps; b)abrir uma rede de relacionamentos do cnpj; c)exibir dados do cnpj; d)selecionar o item na rede original. <br><br></p>
<p><b>versão 0.8.6 (agosto/2022)</b>
- exportação para gráfico no formato (ex-IBM) i2 Chart Reader ou Analyst's Notebook (.anx), pela opção no menu Salvar/Abrir&gt;Salvar i2...:<br><img alt="image" src="https://user-images.githubusercontent.com/71139693/185807202-2e0a7243-d952-470f-bee0-5ef4d45ed38e.png" /><br>
- O i2 Chart Reader pode ser baixado gratuitamente no site https://i2group.com/i2-chart-reader?hsLang=en<br></p>
<ul>
<li>
<p>opção H para abrir árvore com links de busca na página do Google:<img alt="image" src="https://user-images.githubusercontent.com/71139693/185807100-2627141d-d67b-4325-92fa-0014cedaac7c.png" /></p>
</li>
<li>
<p>opção SHIFT+H para abrir árvore com palavras chaves dos links da página do Google. Exemplo: 
<img alt="chaves" src="https://user-images.githubusercontent.com/71139693/189489251-8aba03e6-8cb0-4c68-9a6e-e38655d6b748.png" /></p>
</li>
<li>
<p>para usar a opção SHIFT+H, deve-se instalar as bibliotecas pelo comando pip install -r requirements_chaves.txt<br> e depois instalar os módulos do spacy pelos comandos python -m spacy download en_core_web_sm e python -m spacy download pt_core_news_lg. No arquivo rede.ini, modifique o parâmetro para busca_chaves = 1</p>
</li>
<li>Como a opção de chaves é lenta, ela não foi habilitada para rodar no servidor. Utilize com a versão local do projeto.</li>
</ul>
<p><b>versão 0.8.5 (julho/2022)</b>
- visualização melhorada em celular Android;
- alteração do script rede_relacionamentos.py para rede_sqlite_cnpj.py;
- alteração do parâmetro gravidade, para diminuir a dispersão de grupos não conexos;
- tutorial de instalação passo a passo.</p>
<p><b>versão 0.8.4 (junho/2022)</b>
- aceita CNPJs ou CPFs com zeros à esquerda faltando.</p>
<p><b>versão 0.8.3 (maio/2022)</b>
- inclusão de relacionamento de representante de sócio;
- campo de busca de cpf/cnpj na linha do menu;
- rotina cnpj_search.py para indexar coluna de razão social ou nome de sócio para busca por parte do nome.</p>
<p><b>versão 0.8.2 (janeiro/2022)</b>
- opção no menu Salvar/Abrir&gt;Baixar base CNPJ para abrir a página com o arquivo em SQLITE;
- tecla A - se houver só um item selecionado, abre um gráfico em nova aba no link /rede/grafico/NUMERO_CAMADA/PJ_X, cujo link poderá ser compartilhado;
- usando somente POST em algumas consultas;
- alerta de que consulta por CPF pode apresentar erros. A base da Receita só contem seis dígitos do CPF de sócios, por isso a busca exibe todos os CPFs que tem os mesmo dígitos;
- flask-limiter para diminuir excesso de consultas. Se precisar dos dados por api, rode o projeto localmente e altere os parâmetros limiter_padrao e limiter_dados do arquivo de configuração rede.ini.</p>
<p><b>versão 0.7.4 (dezembro/2021)</b>
- O projeto online pode ser acessado em https://www.redecnpj.com.br;
- usando certificado digital na versão online;</p>
<p><b>versão 0.7.3 (setembro/2021)</b>
- correção de erro em ligação em banco de dados local.</p>
<p><b>versão 0.7.2 (setembro/2021)</b>
- opção para alterar o nome da aba;
- opção para selecionar todos os itens;
- opção para inverter seleção;</p>
<p><b>versão 0.7.1 (agosto/2021)</b>
- opção para dividir gráficos em outras abas (tecla Q);
- correção de erro quando se apertava tecla CTRL;
- opção para selecionar itens adjacentes aos selecionados (tecla J);
- opção para selecionar árvore que contém o item (tecla SHIFT+J);
- opção para listar itens com mais links (tecla CTRL+J)
- opção para selecionar itens com mais ligações para ícones coloridos;
- opção "Nova Aba" (tecla A) abre nova aba com mais de um item selecionado;
- troca de nomes no menu de exportar json para salvar json;
- opção para exportar dados para banco de dados local (só funciona na máquina local);
- opção para exportar para json apenas itens selecionados;
- opção para ocultar rótulos de ligações (SHIFT+N);
- opção para remover todas as ligações dos itens selecionados;
- opção simplifica gráfico (remove itens que não são coloridos ou com comentário que tem apenas uma ligação).</p>
<p><b>versão 0.6.3 (julho/2021)</b>
- melhoria para dar clique duplo em ícones;
- correção de erro de ligação para empresa no exterior sem cnpj;
- somente o ícone pode ser clicado;
- mensagem de alerta para utilizar caractere curinga;
- mudança nas tabelas temporárias;
- todas as tabelas de códigos (cnae, natureza jurídica, etc) foram incorporados ao arquivo sqlite;
- OBSERVAÇÃO. A versão 0.6.3 só vai funcionar com a versão mais atualizada do arquivo cnpj.db referência 16/7/2021.</p>
<p><b>versão 0.5.1 (junho/2021)</b>
- atualização da tabela sqlite cnpj.db com dados públicos de 18/06/2021.</p>
<p><b>versão 0.5 (abril/2021)</b>
- alteração do código para layout novo das tabelas;
- busca por Radical de CNPJ ou CPF de sócio (busca somente pelo miolo do CPF);</p>
<p><b>versão 0.4 (janeiro/2021)</b>
- usando lock para evitar erro de consulta em requisições simultâneas;
- opção para fazer busca do termo no Portal da Transparência da CGU;
- correção de link para google search.</p>
<p><b>versão 0.3.4 (janeiro/2021)</b>
- Possibilita ver o texto do lado direito do ícone;
- diagramas de tabela hierárquica;
- ver diagramas de arquivo com código em python;
- mais opções por linha de comando.</p>
<p><b>versão 0.3 (janeiro/2021)</b>
- Opção para inserção de novos itens para elaboração de mapas mentais;
- Opções para inserir itens novos como link para sites e arquivos locais.
- Opção para arrastar células do excel, leitura de arquivo csv;
- Opções de leitura de entrada por linha de comando;
- Itens selecionados ficam em destaque com linha animada;
- Alteração no formato do arquivo de configuração rede.ini.</p>
<p><b>versão 0.2 (dezembro/2020)</b>
- Suporte para busca por parte do nome na base de empresas;
- Exportação/importação de gráfico no formato json para o servidor.</p>
<p><b>versão 0.1 (setembro/2020)</b>
- Primeira versão</p>
</body></html>